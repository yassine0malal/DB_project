import{c as I,h as Q,a as S,r as m,j as e,B as p,f as u,l as X,L as E,M as Y}from"./index-B1TKH03G.js";import{C as Z,a as _,d as ee,e as te}from"./card-yrt95q4Q.js";import{I as U}from"./input-CCyB3kA2.js";import{d as P,D as re,a as se,b as ae,c as le,S as oe}from"./ShareModal-CNKdFKbW.js";import{D as H,a as L,T as O,f as T}from"./dropdown-menu-l-4mx64D.js";import{M as q,S as B}from"./send-De83bHxe.js";import{H as ne}from"./heart-C0FwWlPt.js";import{S as ie}from"./share-2-BHjpIwdU.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=I("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=I("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),M=Q((t,g)=>({posts:[],isLoading:!1,error:null,filter:"all",setFilter:s=>t({filter:s}),fetchPosts:async s=>{t({isLoading:!0,error:null});try{const{posts:a}=await P.getPosts(s);t({posts:a,isLoading:!1})}catch(a){console.error(a),t({error:a.message,isLoading:!1})}},getFilteredPosts:s=>{const{posts:a,filter:l}=g();let o=[...a];return l==="department"&&s&&(o=o.filter(r=>r.author.department===s)),l==="popular"?o.sort((r,n)=>n.likesCount-r.likesCount):o.sort((r,n)=>new Date(n.createdAt).getTime()-new Date(r.createdAt).getTime()),o},addPost:async s=>{var a;try{const o={id:`temp-${Date.now()}`,createdAt:new Date().toISOString(),likesCount:0,commentsCount:0,sharesCount:0,isLiked:!1,...s,author:{id:s.authorId,firstName:"Moi",lastName:"",role:"student",avatarUrl:""}};t(n=>({posts:[o,...n.posts]})),await P.createPost(s);const r=(a=S.getState().user)==null?void 0:a.id;await g().fetchPosts(r)}catch(l){console.error(l)}},toggleLike:async s=>{var a;t(l=>({posts:l.posts.map(r=>{if(r.id===s){const n=!r.isLiked;return{...r,isLiked:n,likesCount:n?r.likesCount+1:r.likesCount-1}}return r})}));try{const l=(a=S.getState().user)==null?void 0:a.id;if(!l)throw new Error("Not logged in");await P.toggleLike(s,l)}catch(l){console.error(l)}},addComment:async(s,a)=>{var l;try{const o=(l=S.getState().user)==null?void 0:l.id;if(!o)throw new Error("Not logged in");const r=await P.createComment(s,o,a);t(n=>({posts:n.posts.map(i=>i.id===s?{...i,commentsCount:i.commentsCount+1,comments:[...i.comments||[],r]}:i)}))}catch(o){console.error(o)}},addReply:(s,a,l)=>{console.log("Reply added (local only)",s,a,l),t(o=>({posts:o.posts.map(n=>{if(n.id===s&&n.comments){const d=n.comments.map(i=>i.id===a?{...i,replies:[...i.replies||[],l]}:i);return{...n,comments:d,commentsCount:n.commentsCount+1}}return n})}))},deleteComment:(s,a)=>t(l=>({posts:l.posts.map(r=>{if(r.id===s&&r.comments){const n=r.comments.filter(d=>d.id!==a);return{...r,comments:n,commentsCount:r.commentsCount-1}}return r})})),sharePost:s=>{t(a=>({posts:a.posts.map(o=>o.id===s?{...o,sharesCount:(o.sharesCount||0)+1}:o)}))},votePoll:(s,a)=>{t(l=>({posts:l.posts.map(r=>{if(r.id===s&&r.poll){const n=r.poll.userVote;let d=r.poll.options.map(i=>({...i}));return n===a?r:(n&&(d=d.map(i=>i.id===n?{...i,votes:i.votes-1}:i)),d=d.map(i=>i.id===a?{...i,votes:i.votes+1}:i),{...r,poll:{...r.poll,options:d,userVote:a,totalVotes:n?r.poll.totalVotes:r.poll.totalVotes+1}})}return r})}))},reportContent:(s,a,l)=>{console.log(`Reported ${a} ${s}: ${l}`),alert("Contenu signalé aux administrateurs. Merci de votre vigilance.")},deletePost:s=>t(a=>({posts:a.posts.filter(l=>l.id!==s)}))})),xe=["Contenu inapproprié ou offensant","Spam ou publicité indésirable","Harcèlement ou intimidation","Fausses informations","Autre"],J=({isOpen:t,onClose:g,targetId:s,type:a})=>{const{reportContent:l}=M(),[o,r]=m.useState(""),n=()=>{o&&(l(s,a,o),g())};return e.jsx(re,{open:t,onOpenChange:d=>!d&&g(),children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(le,{children:`Signaler ${a==="post"?"cette publication":"ce commentaire"}`})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Aidez-nous à comprendre ce qui ne va pas avec ce contenu."}),e.jsx("div",{className:"space-y-2",children:xe.map(d=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:d,name:"reason",value:d,checked:o===d,onChange:i=>r(i.target.value),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:d,className:"text-sm font-medium text-gray-700 cursor-pointer",children:d})]},d))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(p,{variant:"ghost",onClick:g,children:"Annuler"}),e.jsx(p,{disabled:!o,onClick:n,className:"bg-red-600 hover:bg-red-700 text-white",children:"Signaler"})]})]})]})})},W=({comment:t,postId:g,isReply:s=!1})=>{const[a,l]=m.useState(!1),[o,r]=m.useState(t.likesCount),[n,d]=m.useState(!1),[i,v]=m.useState(""),[k,y]=m.useState(!1),{addReply:j,deleteComment:c}=M(),{user:h}=S(),w=(h==null?void 0:h.id)===t.author.id,N=(h==null?void 0:h.role)==="admin",x=()=>{l(!a),r(f=>a?f-1:f+1)},C=()=>{if(!i.trim()||!h)return;const f={id:Date.now().toString(),content:i,author:h,createdAt:new Date().toISOString(),likesCount:0};j(g,t.id,f),v(""),d(!1)},D=()=>{confirm("Êtes-vous sûr de vouloir supprimer ce commentaire ?")&&c(g,t.id)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:u("flex gap-3 group",s?"mt-3":"mt-4"),children:[e.jsx("div",{className:u("rounded-full bg-gray-200 dark:bg-gray-700 flex-shrink-0 flex items-center justify-center overflow-hidden",s?"h-6 w-6":"h-8 w-8"),children:t.author.avatarUrl?e.jsx("img",{src:t.author.avatarUrl,alt:"",className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-300",children:t.author.firstName[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"bg-gray-100/80 dark:bg-gray-700/60 rounded-2xl px-3 py-2 flex-1 max-w-full",children:[e.jsxs("p",{className:"text-[11px] font-bold text-gray-900 dark:text-gray-100 leading-none mb-1",children:[t.author.firstName," ",t.author.lastName]}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-snug",children:t.content})]}),e.jsxs(H,{trigger:e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(q,{className:"h-3 w-3"})}),children:[(w||N)&&e.jsxs(L,{onClick:D,destructive:!0,className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-3.5 w-3.5"}),"Supprimer"]}),e.jsxs(L,{onClick:()=>y(!0),className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Signaler"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-0.5 px-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500",children:T(new Date(t.createdAt),{addSuffix:!0})}),e.jsxs("button",{onClick:x,className:u("text-[10px] font-bold hover:underline transition-colors",a?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),children:["J'aime ",o>0&&`(${o})`]}),!s&&e.jsx("button",{onClick:()=>d(!n),className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 hover:underline",children:"Répondre"})]}),n&&e.jsxs("div",{className:"mt-2 flex gap-2 items-center animate-in fade-in slide-in-from-top-1",children:[e.jsx(U,{value:i,onChange:f=>v(f.target.value),placeholder:`Répondre à ${t.author.firstName}...`,className:"h-7 text-xs bg-gray-50 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600",onKeyDown:f=>f.key==="Enter"&&C(),autoFocus:!0}),e.jsx("button",{onClick:C,disabled:!i.trim(),className:"text-blue-600 hover:text-blue-700 disabled:opacity-50",children:e.jsx(B,{className:"h-3.5 w-3.5"})})]}),!s&&"replies"in t&&t.replies&&t.replies.length>0&&e.jsx("div",{className:"border-l border-gray-200 dark:border-gray-700 ml-1 pl-4",children:t.replies.map(f=>e.jsx(W,{comment:f,postId:g,isReply:!0},f.id))})]})]}),e.jsx(J,{isOpen:k,onClose:()=>y(!1),targetId:t.id,type:"comment"})]})},ue=({src:t,alt:g,className:s,placeholderClassName:a,skeleton:l=!0,...o})=>{const[r,n]=m.useState(!1),[d,i]=m.useState(!1),[v,k]=m.useState(!1),y=m.useRef(null);m.useEffect(()=>{if(!y.current)return;const h=new IntersectionObserver(w=>{w.forEach(N=>{N.isIntersecting&&(i(!0),h.disconnect())})},{rootMargin:"50px"});return h.observe(y.current),()=>{h.disconnect()}},[]);const j=()=>{n(!0)},c=()=>{k(!0),n(!0)};return e.jsxs("div",{className:"relative overflow-hidden",ref:y,children:[!r&&l&&e.jsx("div",{className:u("absolute inset-0 bg-gradient-to-r from-gray-200 dark:from-gray-700 via-gray-100 dark:via-gray-600 to-gray-200 dark:to-gray-700 animate-pulse",a),children:e.jsx("div",{className:"w-full h-full bg-gray-200 dark:bg-gray-700"})}),d&&!v&&e.jsx("img",{src:t,alt:g,className:u("transition-opacity duration-300",r?"opacity-100":"opacity-0",s),onLoad:j,onError:c,loading:"lazy",...o}),v&&e.jsx("div",{className:u("flex items-center justify-center bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500",s),children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]})},ke=({post:t,className:g})=>{var A,V,$;const[s,a]=m.useState(!1),[l,o]=m.useState(""),[r,n]=m.useState(!1),[d,i]=m.useState(!1),{toggleLike:v,addComment:k,deletePost:y,sharePost:j}=M(),{user:c,followUser:h,unfollowUser:w}=S(),{getUserById:N}=X(),x=N(t.author.id)||t.author,C=async()=>{l.trim()&&(await k(t.id,l),o(""))},D=()=>{j(t.id),i(!0)},f=(c==null?void 0:c.id)===x.id,G=(c==null?void 0:c.role)==="admin",R=(A=c==null?void 0:c.following)==null?void 0:A.includes(x.id);return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:u("overflow-hidden transition-all duration-300 hover:shadow-md border-gray-200 dark:border-gray-700",g),children:[e.jsxs(_,{className:"flex flex-row items-start gap-3 p-4 pb-0",children:[e.jsx(E,{to:`/profile/${x.id}`,className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 relative overflow-hidden rounded-full bg-blue-50 dark:bg-blue-900/30 border border-blue-100 dark:border-blue-800 flex-shrink-0 cursor-pointer transition-transform hover:scale-110",children:x.avatarUrl?e.jsx("img",{src:x.avatarUrl,alt:x.firstName,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center font-bold text-blue-600 dark:text-blue-400",children:x.firstName[0]})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{to:`/profile/${x.id}`,children:e.jsxs("h3",{className:"font-bold text-sm text-gray-900 dark:text-gray-100 leading-none hover:text-blue-700 dark:hover:text-blue-400 hover:underline cursor-pointer truncate",children:[x.firstName," ",x.lastName]})}),!f&&e.jsx(p,{variant:"ghost",size:"sm",className:u("h-6 px-2 text-[10px] font-bold rounded-full transition-all",R?"text-gray-400 dark:text-gray-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20":"text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20"),onClick:()=>R?w(x.id):h(x.id),children:R?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Suivi(e)"]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Suivre"]})})]}),x.department&&e.jsxs("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1 font-medium truncate italic",children:[x.department," • ",x.role]})]}),e.jsxs(H,{trigger:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(q,{className:"h-4 w-4"})}),children:[(f||G)&&e.jsxs(L,{onClick:()=>y(t.id),destructive:!0,className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Supprimer"]}),e.jsxs(L,{onClick:()=>n(!0),className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Signaler"]})]})]}),e.jsx("p",{className:"text-[9px] text-gray-400 dark:text-gray-500 font-medium",children:T(new Date(t.createdAt),{addSuffix:!0})})]})]}),e.jsxs(ee,{className:"p-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap",children:t.content}),t.imageUrl&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 relative group",children:e.jsx(ue,{src:t.imageUrl,alt:"Post content",className:"w-full h-auto max-h-[500px] object-cover"})}),t.poll&&e.jsxs("div",{className:"space-y-2 mt-2",children:[t.poll.options.map(b=>{const z=t.poll.totalVotes>0?Math.round(b.votes/t.poll.totalVotes*100):0,F=t.poll.userVote===b.id;return e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>M.getState().votePoll(t.id,b.id),className:u("relative w-full text-left py-2 px-3 rounded-md text-sm border transition-all overflow-hidden z-10 hover:border-blue-300 dark:hover:border-blue-600",F?"border-blue-500 dark:border-blue-600 font-semibold text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"),children:[e.jsxs("span",{className:"relative z-10 flex justify-between",children:[e.jsx("span",{children:b.label}),e.jsxs("span",{children:[z,"%"]})]}),e.jsx("div",{className:u("absolute top-0 left-0 h-full transition-all duration-500 ease-out opacity-20",F?"bg-blue-600 dark:bg-blue-500":"bg-gray-300 dark:bg-gray-600"),style:{width:`${z}%`}})]})},b.id)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 pt-1 text-right",children:[t.poll.totalVotes," votes • ",t.poll.endDate?`Fin le ${new Date(t.poll.endDate).toLocaleDateString()}`:"En cours"]})]})]}),e.jsxs(te,{className:"p-1 border-t dark:border-gray-700 flex flex-col bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center w-full px-2 py-0.5",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>v(t.id),className:u("flex-1 gap-2 rounded-lg transition-all",t.isLiked?"text-blue-600 dark:text-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-900/20":"text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(ne,{className:u("h-4 w-4 transition-all duration-300",t.isLiked&&"fill-current scale-110")}),e.jsx("span",{className:"text-xs font-bold",children:t.likesCount})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>a(!s),className:u("flex-1 gap-2 rounded-lg transition-all",s?"text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20":"text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-bold",children:t.commentsCount})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:D,className:"flex-1 gap-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all",children:[e.jsx(ie,{className:u("h-4 w-4",t.sharesCount>0&&"text-blue-600")}),e.jsx("span",{className:u("text-xs font-bold",t.sharesCount>0&&"text-blue-600"),children:t.sharesCount>0?`${t.sharesCount}`:"Partager"})]})]}),s&&e.jsxs("div",{className:"w-full p-4 border-t dark:border-gray-700 bg-gray-50/20 dark:bg-gray-800/50 animate-in fade-in slide-in-from-top-1 duration-300",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex-shrink-0 border border-white dark:border-gray-700 shadow-sm flex items-center justify-center text-[10px] font-bold text-blue-600 dark:text-blue-400 overflow-hidden",children:c!=null&&c.avatarUrl?e.jsx("img",{src:c.avatarUrl,className:"h-full w-full object-cover"}):(V=c==null?void 0:c.firstName)==null?void 0:V[0]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(U,{value:l,onChange:b=>o(b.target.value),onKeyDown:b=>b.key==="Enter"&&C(),placeholder:"Écrire un commentaire...",className:"bg-white dark:bg-gray-700 dark:text-gray-100 border-gray-200 dark:border-gray-600 pr-10 rounded-2xl text-xs h-8 focus:ring-1 focus:ring-blue-500"}),e.jsx("button",{onClick:C,disabled:!l.trim(),className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 hover:text-blue-600 disabled:text-gray-300 dark:disabled:text-gray-600 transition-colors",children:e.jsx(B,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[($=t.comments)==null?void 0:$.map(b=>e.jsx(W,{comment:b,postId:t.id},b.id)),(!t.comments||t.comments.length===0)&&e.jsx("p",{className:"text-center text-[11px] text-gray-400 dark:text-gray-500 py-4 italic",children:"Soyez le premier à commenter cette publication."})]})]})]})]}),e.jsx(J,{isOpen:r,onClose:()=>n(!1),targetId:t.id,type:"post"}),e.jsx(oe,{isOpen:d,onClose:()=>i(!1),title:`Publication de ${x.firstName}`,url:`${window.location.origin}/posts/${t.id}`})]})};export{ue as L,ke as P,de as U,ce as a,M as u};
