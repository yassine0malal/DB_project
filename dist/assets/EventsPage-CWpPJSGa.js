import{h,j as e,C as u,B as g,a as p,r as f}from"./index-B1TKH03G.js";import{d as x}from"./ShareModal-CNKdFKbW.js";import{E as y}from"./EventCard-8KgUZ8k2.js";import{C as j,a as v,b,d as N}from"./card-yrt95q4Q.js";import{I as w}from"./input-CCyB3kA2.js";import{S as k}from"./search-VCfrvYJp.js";import{M as C}from"./map-pin-C1CkJR1H.js";import{F as E}from"./filter-Xg0ROrOg.js";import"./check-D4-FbOjS.js";import"./badge-CpBV-KiU.js";import"./useClubStore-Dc6iDVhX.js";import"./video-Dvf87XYw.js";import"./clock-Cew70h3k.js";import"./share-2-BHjpIwdU.js";const D=h((n,i)=>({events:[],filters:{search:"",date:"all",onCampus:!1,online:!1},isLoading:!1,error:null,setEvents:s=>n({events:s}),fetchEvents:async s=>{n({isLoading:!0,error:null});try{const{events:t}=await x.getEvents(s);n({events:t,isLoading:!1})}catch(t){n({isLoading:!1,error:t.message})}},joinEvent:async(s,t)=>{n(r=>({events:r.events.map(a=>a.id===s?{...a,isAttending:!0,attendeesCount:(a.attendeesCount||0)+1}:a)}));try{await x.joinEvent(s,t)}catch(r){n(a=>({events:a.events.map(l=>l.id===s?{...l,isAttending:!1,attendeesCount:Math.max(0,(l.attendeesCount||0)-1)}:l)})),console.error(r)}},leaveEvent:async(s,t)=>{n(r=>({events:r.events.map(a=>a.id===s?{...a,isAttending:!1,attendeesCount:Math.max(0,(a.attendeesCount||0)-1)}:a)}));try{await x.leaveEvent(s,t)}catch(r){n(a=>({events:a.events.map(l=>l.id===s?{...l,isAttending:!0,attendeesCount:(l.attendeesCount||0)+1}:l)})),console.error(r)}},setFilter:(s,t)=>n(r=>({filters:{...r.filters,[s]:t}})),getFilteredEvents:()=>{const{events:s,filters:t}=i();return s.filter(r=>{if(t.search&&!r.title.toLowerCase().includes(t.search.toLowerCase()))return!1;const a=new Date(r.date),l=new Date;if(t.date==="today"&&a.getDate()!==l.getDate())return!1;if(t.date==="week"){const c=new Date;if(c.setDate(l.getDate()+7),a>c||a<l)return!1}return!(t.onCampus&&r.isOnline||t.online&&!r.isOnline||t.onCampus&&!t.online&&r.isOnline||t.online&&!t.onCampus&&!r.isOnline)})}})),A=({className:n,activeFilters:i,onFilterChange:s})=>e.jsxs(j,{className:n,children:[e.jsx(v,{children:e.jsx(b,{className:"text-lg text-gray-900 dark:text-gray-100",children:"Filtres"})}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Recherche"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500 dark:text-gray-400"}),e.jsx(w,{placeholder:"Rechercher un événement...",value:i.search||"",onChange:t=>s("search",t.target.value),className:"pl-9 dark:bg-gray-800 dark:border-gray-700"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx(u,{className:"h-4 w-4"})," Date"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","today","week","month"].map(t=>e.jsx(g,{variant:i.date===t?"default":"outline",size:"sm",onClick:()=>s("date",t),className:"capitalize",children:t==="all"?"Tout":t==="today"?"Auj.":t==="week"?"Cette sem.":"Ce mois"},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx(C,{className:"h-4 w-4"})," Localisation"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:i.onCampus,onChange:t=>s("onCampus",t.target.checked),className:"rounded border-gray-300"}),"Sur le campus"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:i.online,onChange:t=>s("online",t.target.checked),className:"rounded border-gray-300"}),"En ligne (Visio)"]})]})]})]})]}),W=()=>{const{fetchEvents:n,getFilteredEvents:i,filters:s,setFilter:t,isLoading:r}=D(),{user:a}=p();f.useEffect(()=>{n(a==null?void 0:a.id)},[a==null?void 0:a.id]);const l=i(),c=l.filter(d=>{const o=new Date(d.date),m=new Date;return o.getDate()===m.getDate()&&o.getMonth()===m.getMonth()&&o.getFullYear()===m.getFullYear()});return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 pb-10",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Événements"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Ne manquez rien de la vie étudiante !"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx(A,{activeFilters:s,onFilterChange:(d,o)=>t(d,o)}),c.length>0&&e.jsxs("div",{className:"bg-blue-600 rounded-xl p-6 text-white text-center shadow-lg shadow-blue-200",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-3",children:e.jsx(u,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-lg",children:"Aujourd'hui"}),e.jsxs("p",{className:"text-blue-100 text-sm mb-4",children:[c.length," événements prévus"]}),e.jsx(g,{variant:"outline",className:"w-full text-blue-700 font-bold bg-white hover:bg-blue-50",children:"Voir le programme"})]})]}),e.jsx("div",{className:"lg:col-span-3 space-y-6",children:r?e.jsx("div",{className:"min-h-[200px] flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(d=>e.jsx(y,{event:d,clubName:d.clubName,vertical:!0},d.id))}):e.jsxs("div",{className:"text-center py-20 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-full inline-block shadow-sm mb-4",children:e.jsx(E,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Aucun événement trouvé"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Essayez d'autres filtres."})]})})]})]})};export{W as EventsPage};
